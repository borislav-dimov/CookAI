<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ChefAI - Settings</title>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <style>
        /* --- GLOBAL & STRUCTURE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding: 0; background-color: #f2f2f7; 
            height: 100vh; width: 100vw; overflow: hidden; 
            display: flex; justify-content: center;
        }
        .app-shell {
            width: 100%; height: 100%; background-color: #f2f2f7;
            display: flex; flex-direction: column; position: relative; overflow-y: auto;
        }
        @media (min-width: 900px) {
            body { align-items: center; }
            .app-shell { max-width: 414px; height: 896px; border-radius: 40px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        }

        /* --- FIXED ELEMENTS --- */
        .top-bar {
            height: 60px; background-color: #fff; display: flex; align-items: center; 
            justify-content: space-between; padding: 0 15px; z-index: 20; flex-shrink: 0; 
            border-bottom: 1px solid #eee;
        }
        .header-title { font-size: 1.1rem; font-weight: 600; color: #000; }
        .back-btn { font-size: 24px; color: #007aff; cursor: pointer; text-decoration: none; }
        
        /* --- CONTENT & SETTINGS STYLES (Restored Original Look) --- */
        .content-container { 
            padding: 20px;
        }
        .section-title { font-size: 1.6rem; margin: 0 0 25px 0; font-weight: 700; color: #000; }
        
        .setting-group {
            margin-bottom: 30px;
        }
        .setting-group h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #444;
            margin: 0 0 10px 0;
        }
        .option-row {
            display: flex;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
        }
        .option-btn {
            flex-grow: 1;
            padding: 12px 0;
            text-align: center;
            font-weight: 500;
            color: #000;
            cursor: pointer;
            border-right: 1px solid #ddd;
        }
        .option-btn:last-child {
            border-right: none;
        }
        .option-btn.active {
            background-color: #007aff;
            color: white;
            font-weight: 600;
            border-color: #007aff;
        }
        
        /* --- DARK MODE OVERRIDES (Restored) --- */
        body.dark-mode .app-shell { background-color: #000; }
        body.dark-mode .top-bar { background-color: #1c1c1e; border-color: #333; }
        body.dark-mode .header-title, body.dark-mode .section-title, body.dark-mode .setting-group h3 { color: #fff; }
        body.dark-mode .content-container { background-color: #000; }
        
        /* Dark mode settings controls */
        body.dark-mode .option-row { background-color: #2c2c2e; border-color: #3a3a3c; }
        body.dark-mode .option-btn { color: #fff; border-right-color: #3a3a3c; }
        body.dark-mode .option-btn.active { background-color: #0A84FF; color: #fff; border-color: #0A84FF; }
        body.dark-mode .setting-group h3 { color: #999; } /* Subtle group title in dark mode */
        
        /* Log Out Button Styling */
        .logout-btn-container {
            margin-top: 40px; 
            margin-bottom: 20px;
        }
        .logout-btn {
            background-color: #ff3b30; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 30px; 
            font-weight: 600; 
            cursor: pointer; 
            width: 100%;
            text-align: center;
            text-decoration: none;
            display: block;
        }
        body.dark-mode .logout-btn {
            background-color: #ff453a; /* Slightly adjusted red for better dark mode contrast */
        }
        
    </style>
</head>
<body class="{{ 'dark-mode' if userSettings.mode == 'dark' else '' }}">

<div class="app-shell">
    
    <div class="top-bar">
        <a href="{{ url_for('account_page') }}" class="back-btn">
            <ion-icon name="chevron-back-outline"></ion-icon>
        </a>
        <div class="header-title" id="ui-header-title">App Settings</div>
        <div></div> </div>

    <div class="content-container">
        
        <div class="setting-group">
            <h3 id="ui-appearance">Appearance</h3>
            <div class="option-row" id="mode-options">
                <div id="opt-light" class="option-btn" onclick="setMode('light')">Light</div>
                <div id="opt-dark" class="option-btn" onclick="setMode('dark')">Dark</div>
            </div>
        </div>
        
        <div class="setting-group">
            <h3 id="ui-unit-system">Unit System</h3>
            <div class="option-row" id="units-options">
                <div id="opt-metric" class="option-btn" onclick="setUnits('Metric')">Metric (kg)</div>
                <div id="opt-imperial" class="option-btn" onclick="setUnits('Imperial')">Imperial (lb)</div>
            </div>
        </div>

        <div class="setting-group">
            <h3 id="ui-language-setting">Language</h3>
            <div class="option-row" id="language-options">
                <div id="opt-english" class="option-btn" onclick="setLanguage('English')">English</div>
                <div id="opt-bulgarian" class="option-btn" onclick="setLanguage('Bulgarian')">Български</div>
            </div>
        </div>
        
        <div class="setting-group">
            <h3 id="ui-data-settings">Data & Storage</h3>
            <div class="option-row" style="padding: 0;">
                 <button id="ui-clear-cache" onclick="clearCache()" style="background-color: #ff3b30; color: white; border: none; padding: 12px 20px; border-radius: 10px; font-weight: 500; cursor: pointer; flex-grow: 1;">
                    Clear Local Cache
                </button>
            </div>
        </div>
        
        <div class="logout-btn-container">
            <a href="{{ url_for('logout') }}" class="logout-btn" id="ui-logout-btn">
                Log Out
            </a>
        </div>

        <p style="text-align: center; margin-top: 30px; font-size: 0.8rem; color: #aaa;">
            ChefAI v1.0
        </p>
        
    </div>

</div>

<script>
    // --- DICTIONARY FOR BULGARIAN SUPPORT ---
    const i18n = {
        'English': {
            'header-title': 'App Settings',
            'appearance': 'Appearance',
            'unit-system': 'Unit System',
            'language-setting': 'Language',
            'data-settings': 'Data & Storage',
            'clear-cache': 'Clear Local Cache',
            'clear-alert': 'Local settings and cache cleared! Please refresh to ensure all pages update correctly.',
            'logout-btn': 'Log Out', // NEW ENTRY
            // Unit system button labels
            'metric-label': 'Metric (kg)',
            'imperial-label': 'Imperial (lb)',
            'english-label': 'English',
            'bulgarian-label': 'Български',
            'light-label': 'Light',
            'dark-label': 'Dark',
        },
        'Bulgarian': {
            'header-title': 'Настройки на Приложението',
            'appearance': 'Външен вид',
            'unit-system': 'Мерни Единици',
            'language-setting': 'Език',
            'data-settings': 'Данни и Памет',
            'clear-cache': 'Изчистване на Локалния Кеш',
            'clear-alert': 'Локалните настройки и кешът са изчистени! Моля, опреснете, за да се актуализират всички страници правилно.',
            'logout-btn': 'Изход', // NEW ENTRY
            // Unit system button labels
            'metric-label': 'Метрична (kg)',
            'imperial-label': 'Имперска (lb)',
            'english-label': 'Английски',
            'bulgarian-label': 'Български',
            'light-label': 'Светъл',
            'dark-label': 'Тъмен',
        }
    };

    // --- STATE & INITIALIZATION ---

    let userSettings = { 
        units: localStorage.getItem('chefai_units') || 'Metric', 
        language: localStorage.getItem('chefai_language') || 'English',
        mode: localStorage.getItem('chefai_mode') || 'light'
    };

    /**
     * Updates the active state of buttons within a specific group.
     * @param {string} groupId - The ID of the option row container (e.g., 'mode-options').
     * @param {string} value - The current active value (e.g., 'light', 'Metric', 'English').
     */
    function updateButtonState(groupId, value) {
        const row = document.getElementById(groupId);
        if (!row) return;

        // 1. Clear active class from ALL buttons in this row
        row.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('active'));
        
        // 2. Set the active class on the corresponding button
        const activeBtn = document.getElementById(`opt-${value.toLowerCase()}`);
        if (activeBtn) {
            activeBtn.classList.add('active');
        }
    }
    
    function applySettings() {
        // 1. Apply Mode (Dark/Light) to the body class
        if (userSettings.mode === 'dark') {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
        
        // 2. Apply Button States
        updateButtonState('mode-options', userSettings.mode);
        updateButtonState('units-options', userSettings.units);
        updateButtonState('language-options', userSettings.language);

        // 3. Translate UI
        translateUI();
    }

    // --- TRANSLATION LOGIC ---
    function translateUI() {
        const lang = userSettings.language;
        const dict = i18n[lang] || i18n['English'];

        // Headings & Text
        document.getElementById('ui-header-title').textContent = dict['header-title'];
        document.getElementById('ui-appearance').innerHTML = `${dict['appearance']}`;
        document.getElementById('ui-unit-system').innerHTML = `${dict['unit-system']}`;
        document.getElementById('ui-language-setting').innerHTML = `${dict['language-setting']}`;
        document.getElementById('ui-data-settings').innerHTML = `${dict['data-settings']}`;
        document.getElementById('ui-clear-cache').textContent = dict['clear-cache'];
        document.getElementById('ui-logout-btn').textContent = dict['logout-btn']; // TRANSLATE LOGOUT

        // Buttons
        document.getElementById('opt-light').textContent = dict['light-label'];
        document.getElementById('opt-dark').textContent = dict['dark-label'];
        document.getElementById('opt-metric').textContent = dict['metric-label'];
        document.getElementById('opt-imperial').textContent = dict['imperial-label'];
        document.getElementById('opt-english').textContent = dict['english-label'];
        document.getElementById('opt-bulgarian').textContent = dict['bulgarian-label'];
    }


    // --- EVENT HANDLERS (Calling applySettings to update UI) ---
    
    function setMode(newMode) {
        localStorage.setItem('chefai_mode', newMode);
        userSettings.mode = newMode;
        applySettings();
    }
    
    function setUnits(newUnits) {
        localStorage.setItem('chefai_units', newUnits);
        userSettings.units = newUnits;
        applySettings();
    }
    
    function setLanguage(newLang) {
        localStorage.setItem('chefai_language', newLang);
        userSettings.language = newLang;
        applySettings();
    }
    
    function clearCache() {
        localStorage.removeItem('chefai_mode');
        localStorage.removeItem('chefai_language');
        localStorage.removeItem('chefai_units');

        // Reset settings to defaults
        userSettings = { 
            units: 'Metric', 
            language: 'English',
            mode: 'light'
        };

        const lang = userSettings.language;
        const dict = i18n[lang] || i18n['English'];
        
        // Re-apply and alert user
        applySettings();
        alert(dict['clear-alert']);
    }

    // --- INITIALIZATION ---
    applySettings();
</script>
</body>
</html>